config("protobuf_includes") {
  include_dirs = [
    "include",
    "repo/src",
  ]
}

static_library("libprotobuf-lite") {
  sources = [
    "repo/src/google/protobuf/extension_set.cc",
    "repo/src/google/protobuf/generated_message_util.cc",
    "repo/src/google/protobuf/io/coded_stream.cc",
    "repo/src/google/protobuf/io/zero_copy_stream.cc",
    "repo/src/google/protobuf/io/zero_copy_stream_impl_lite.cc",
    "repo/src/google/protobuf/message_lite.cc",
    "repo/src/google/protobuf/repeated_field.cc",
    "repo/src/google/protobuf/stubs/common.cc",
    "repo/src/google/protobuf/stubs/once.cc",
    "repo/src/google/protobuf/stubs/stringprintf.cc",
    "repo/src/google/protobuf/wire_format_lite.cc",
  ]
  public = [
    "repo/src/google/protobuf/stubs/coded_stream_inl.h",
    "repo/src/google/protobuf/stubs/hash.h",
    "repo/src/google/protobuf/stubs/map_util.h",
    "repo/src/google/protobuf/stubs/shared_ptr.h",
    "repo/src/google/protobuf/stubs/stringprintf.h",
  ]

  if (current_cpu == "x86" || current_cpu == "x64") {
    sources += [
      "repo/src/google/protobuf/stubs/atomicops_internals_x86_gcc.cc",
      "repo/src/google/protobuf/stubs/atomicops_internals_x86_msvc.cc",
    ]
  }

  defines = [ "GOOGLE_PROTOBUF_NO_RTTI" ]

  if (current_cpu == "x86" || current_cpu == "x64") {
    defines += [ "GOOGLE_PROTOBUF_ARCH_X64" ]
  } else if (current_cpu == "mipsel_24kec") {
    defines += [ "GOOGLE_PROTOBUF_ARCH_MIPS" ]
  }

  cflags_cc = [ "-w" ]  # suppress all warnings
  public_configs = [ ":protobuf_includes" ]
}
